<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="icon.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Software Downloads</title>
  <style>
    /* Your original styles here (unchanged) */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f8f9fa;
      color: #333;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }

    h1 {
      text-align: center;
      color: #222;
      margin-bottom: 20px;
    }

    /* Search bar */
    .search-container {
      text-align: center;
      margin-bottom: 30px;
    }

    .search-container input {
      width: 80%;
      max-width: 400px;
      padding: 10px 15px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.2s;
    }

    .search-container input:focus {
      border-color: #0070f3;
    }

    /* Responsive grid layout */
    .wrap {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      padding: 10px;
    }

    /* Software card */
    .software {
      background: #fff;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .software:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .software img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .software h2 {
      margin: 0 0 10px 0;
      font-size: 1.1em;
      color: #0070f3;
    }

    /* Download button */
    .download-btn {
      display: inline-block;
      margin-top: 10px;
      padding: 10px 18px;
      background: #0070f3;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      transition: background 0.2s ease;
    }

    .download-btn:hover {
      background: #0056c7;
    }

    /* Checksum text */
    .checksum {
      font-size: 0.9em;
      color: #555;
      margin-top: 8px;
      word-break: break-all;
    }

    /* Footer */
    footer {
      text-align: center;
      color: #777;
      margin-top: 40px;
      font-size: 0.9em;
    }

    /* Hide when filtered out */
    .hidden {
      display: none;
    }

    /* New: Admin Button and Modal */
    .admin-section {
      text-align: center;
      margin-bottom: 20px;
    }

    .admin-btn {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }

    .admin-btn:hover {
      background: #218838;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 400px;
      text-align: center;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }

    .close:hover {
      color: #000;
    }

    input[type="password"], input[type="email"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .login-btn {
      padding: 10px 20px;
      background: #0070f3;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* Dashboard Styles */
    #dashboard {
      display: none;
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    #dashboard h2 {
      text-align: center;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
    }

    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .btn {
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-primary { background: #0070f3; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-success { background: #28a745; color: white; }

    .software-list-admin {
      margin-top: 20px;
    }

    .software-admin-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }

    /* Edit Modal */
    #editModal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }

    #editModal .modal-content {
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    #editForm input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Download Center</h1>

  <!-- Admin Login Button -->
  <div class="admin-section">
    <button class="admin-btn" onclick="openLoginModal()">Admin Login</button>
  </div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeLoginModal()">&times;</span>
      <h3>Admin Login</h3>
      <form onsubmit="login(event)">
        <div class="form-group">
          <input type="email" id="email" placeholder="Email (e.g., admin@example.com)" required>
        </div>
        <div class="form-group">
          <input type="password" id="password" placeholder="Password" required>
        </div>
        <button type="submit" class="login-btn">Login</button>
      </form>
      <p id="loginError" style="color: red; display: none;">Invalid credentials!</p>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeEditModal()">&times;</span>
      <h3>Edit Software</h3>
      <form id="editForm" onsubmit="updateSoftware(event)">
        <input type="hidden" id="editId">
        <div class="form-group">
          <label>Title:</label>
          <input type="text" id="editTitle" required>
        </div>
        <div class="form-group">
          <label>Image URL:</label>
          <input type="url" id="editImageUrl" required>
        </div>
        <div class="form-group">
          <label>Download URL:</label>
          <input type="url" id="editDownloadUrl" required>
        </div>
        <div class="form-group">
          <label>Checksum/Description:</label>
          <input type="text" id="editChecksum" required>
        </div>
        <button type="submit" class="btn btn-success">Update</button>
      </form>
    </div>
  </div>

  <!-- Dashboard (Hidden until login) -->
  <div id="dashboard">
    <h2>Admin Dashboard</h2>
    <button class="btn btn-danger" onclick="logout()">Logout</button>
    
    <!-- Add New Software Form -->
    <h3>Add New Software</h3>
    <form id="addForm" onsubmit="addSoftware(event)">
      <div class="form-group">
        <label>Title:</label>
        <input type="text" id="title" required>
      </div>
      <div class="form-group">
        <label>Image URL:</label>
        <input type="url" id="imageUrl" required>
      </div>
      <div class="form-group">
        <label>Download URL:</label>
        <input type="url" id="downloadUrl" required>
      </div>
      <div class="form-group">
        <label>Checksum/Description:</label>
        <input type="text" id="checksum" required>
      </div>
      <button type="submit" class="btn btn-success">Add</button>
    </form>

    <!-- Admin Software List (for Edit/Delete) -->
    <div class="software-list-admin">
      <h3>Manage Software</h3>
      <div id="adminSoftwareList"></div>
    </div>
  </div>

  <!-- Your Original Search and List -->
  <div class="search-container">
    <input type="text" id="searchBox" placeholder="Search software...">
  </div>

  <div class="wrap" id="softwareList">
    <!-- Software cards will be populated by JS from Firestore -->
  </div>

  <footer>
    Â© 2025 My Software Downloads
  </footer>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDElnKtC3Xjxz_JkjP9C2SaaQsuk45Nnhg",
      authDomain: "dlsoftware-33654.firebaseapp.com",
      projectId: "dlsoftware-33654",
      storageBucket: "dlsoftware-33654.firebasestorage.app",
      messagingSenderId: "403361976439",
      appId: "1:403361976439:web:7da55530cb4134aa927672",
      measurementId: "G-XKNGQG2KYT"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Auth State Listener
    onAuthStateChanged(auth, (user) => {
      const dashboard = document.getElementById('dashboard');
      if (user) {
        dashboard.style.display = 'block';
        loadSoftware(); // Load and render list
        loadAdminList(); // Load for dashboard
      } else {
        dashboard.style.display = 'none';
      }
    });

    // Login Function
    window.login = async (event) => {
      event.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('loginError');

      try {
        await signInWithEmailAndPassword(auth, email, password);
        closeLoginModal();
        errorEl.style.display = 'none';
      } catch (error) {
        errorEl.style.display = 'block';
      }
    };

    // Logout
    window.logout = () => {
      signOut(auth);
    };

    // Modal Functions
    window.openLoginModal = () => {
      document.getElementById('loginModal').style.display = 'block';
    };

    window.closeLoginModal = () => {
      document.getElementById('loginModal').style.display = 'none';
    };

    window.openEditModal = (id, data) => {
      document.getElementById('editId').value = id;
      document.getElementById('editTitle').value = data.title;
      document.getElementById('editImageUrl').value = data.imageUrl;
      document.getElementById('editDownloadUrl').value = data.downloadUrl;
      document.getElementById('editChecksum').value = data.checksum;
      document.getElementById('editModal').style.display = 'block';
    };

    window.closeEditModal = () => {
      document.getElementById('editModal').style.display = 'none';
    };

    // Load Software from Firestore and Render
    async function loadSoftware() {
      const querySnapshot = await getDocs(collection(db, 'software'));
      const softwareList = document.getElementById('softwareList');
      softwareList.innerHTML = '';
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const card = `
          <div class="software">
            <img src="${data.imageUrl}" alt="${data.title}">
            <h2>${data.title}</h2>
            <a class="download-btn" href="${data.downloadUrl}">Download</a>
            <p class="checksum">${data.checksum}</p>
          </div>
        `;
        softwareList.innerHTML += card;
      });
      // Re-attach search after render
      attachSearch();
    }

    // Load for Admin Dashboard
    async function loadAdminList() {
      const querySnapshot = await getDocs(collection(db, 'software'));
      const adminList = document.getElementById('adminSoftwareList');
      adminList.innerHTML = '';
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const id = doc.id;
        const item = `
          <div class="software-admin-item">
            <strong>${data.title}</strong><br>
            <img src="${data.imageUrl}" width="32" height="32" style="object-fit: contain;"><br>
            <button class="btn btn-primary" onclick="openEditModal('${id}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">Edit</button>
            <button class="btn btn-danger" onclick="deleteSoftware('${id}')">Delete</button>
          </div>
        `;
        adminList.innerHTML += item;
      });
    }

    // Add Software
    window.addSoftware = async (event) => {
      event.preventDefault();
      const data = {
        title: document.getElementById('title').value,
        imageUrl: document.getElementById('imageUrl').value,
        downloadUrl: document.getElementById('downloadUrl').value,
        checksum: document.getElementById('checksum').value
      };
      try {
        await addDoc(collection(db, 'software'), data);
        loadSoftware();
        loadAdminList();
        document.getElementById('addForm').reset();
      } catch (error) {
        alert('Error adding software: ' + error.message);
      }
    };

    // Update Software
    window.updateSoftware = async (event) => {
      event.preventDefault();
      const id = document.getElementById('editId').value;
      const data = {
        title: document.getElementById('editTitle').value,
        imageUrl: document.getElementById('editImageUrl').value,
        downloadUrl: document.getElementById('editDownloadUrl').value,
        checksum: document.getElementById('editChecksum').value
      };
      try {
        await updateDoc(doc(db, 'software', id), data);
        closeEditModal();
        loadSoftware();
        loadAdminList();
      } catch (error) {
        alert('Error updating software: ' + error.message);
      }
    };

    // Delete Software
    window.deleteSoftware = async (id) => {
      if (confirm('Delete this software?')) {
        try {
          await deleteDoc(doc(db, 'software', id));
          loadSoftware();
          loadAdminList();
        } catch (error) {
          alert('Error deleting software: ' + error.message);
        }
      }
    };

    // Original Search (re-attach after load)
    function attachSearch() {
      const searchBox = document.getElementById('searchBox');
      searchBox.value = ''; // Clear search on reload
      const softwareList = document.getElementById('softwareList');
      const softwares = softwareList.getElementsByClassName('software');
      const handler = () => {
        const searchTerm = searchBox.value.toLowerCase();
        for (let item of softwares) {
          const title = item.querySelector('h2').textContent.toLowerCase();
          item.classList.toggle('hidden', !title.includes(searchTerm));
        }
      };
      searchBox.removeEventListener('input', handler); // Prevent duplicates
      searchBox.addEventListener('input', handler);
    }

    // Initial Load (Public View)
    loadSoftware();
    attachSearch();
  </script>
</body>
</html>
